platform :android do
  lane :deploy_appcenter do |options|
    load_env(env: options[:env])

    appcenter_upload(
      api_token: ENV["ANDROID_APPCENTER_API_TOKEN"],
      owner_name: "Alrajhi-Bank",
      owner_type: "organization", # Default is user - set to organization for appcenter organizations
      app_name: ENV["ANDROID_APPCENTER_APP"],
      file: "#{ENV["OUTPUT_DIRECTORY"]}/#{ENV["ANDROID_OUTPUT_NAME"]}",
      notify_testers: true
    )
  end

  lane :upload_browserstack do |options|
    load_env(env: options[:env])

    upload_to_browserstack_app_live(
      browserstack_username: ENV["BROWSERSTACK_USERNAME"],
      browserstack_access_key: ENV["BROWSERSTACK_ACCESS_KEY"],
      file_path: "#{ENV["OUTPUT_DIRECTORY"]}/#{ENV["ANDROID_OUTPUT_NAME"]}",
    )
  end


  # lane :deploy_release do |options|
  #   load_env(env: options[:env])

  #   upload_to_play_store(
  #     package_name: ENV["APP_IDENTIFIER"],
  #     track: "internal",
  #     release_status: "completed",
  #     json_key: ENV["ANDROID_PLAYSTORE_JSON_KEY"],
  #     aab: "#{ENV["OUTPUT_DIRECTORY"]}/app-prod-release.aab",
  #     mapping: "#{ENV["OUTPUT_DIRECTORY"]}/mapping.txt",
  #   )
  # end
end

platform :ios do
  lane :deploy_appcenter do |options|
    load_env(env: options[:env])

    appcenter_upload(
      api_token: ENV["IOS_APPCENTER_API_TOKEN"],
      owner_name: "Alrajhi-Bank",
      owner_type: "organization", # Default is user - set to organization for appcenter organizations
      app_name: ENV["IOS_APPCENTER_APP"],
      file: "#{ENV["OUTPUT_DIRECTORY"]}/CroatiaMobileApp.ipa",
      notify_testers: true
    )
  end

  # lane :deploy_release do |options|
  #   load_env(env: options[:env])

  #   version = ios_get_version(
  #     xcodeproj: File.join(Dir.pwd, "../ios", ENV["IOS_XCODE_PROJ"])
  #   )

  #   build_number = ios_get_build_number(
  #     xcodeproj: File.join(Dir.pwd, "../ios", ENV["IOS_XCODE_PROJ"])
  #   )

  #   app_store_connect_api_key(
  #     key_id: ENV["IOS_APPSTORE_CONNECT_KEY_ID"],
  #     issuer_id: ENV["IOS_APPSTORE_CONNECT_KEY_ISSUER_ID"],
  #     key_filepath: ENV["IOS_APPSTORE_CONNECT_KEY"]
  #   )

  #   upload_to_testflight(
  #     app_identifier: ENV["APP_IDENTIFIER"],
  #     ipa: "#{ENV["OUTPUT_DIRECTORY"]}/#{ENV["IOS_IPA_NAME"]}",
  #     skip_submission: true,
  #     skip_waiting_for_build_processing: true
  #   )

  #   deliver(
  #     app_identifier: ENV["APP_IDENTIFIER"],
  #     app_version: version,
  #     build_number: build_number,
  #     skip_binary_upload: true,
  #     skip_screenshots: true,
  #     skip_metadata: true,
  #     force: true,
  #     ignore_language_directory_validation: true,
  #     precheck_include_in_app_purchases: false,
  #     verbose: true
  #   )
  # end
end
